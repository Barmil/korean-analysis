<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="content-type">
<style type="text/css">
ol{margin:0;padding:0}table td,table th{padding:0}.c8{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:468pt;border-top-color:#000000;border-bottom-style:solid}.c9{border-right-style:dotted;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:300.8pt;border-top-color:#000000;border-bottom-style:dashed}.c25{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:1pt;border-left-color:#000000;vertical-align:middle;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:dotted;border-bottom-width:0pt;width:31.5pt;border-top-color:#000000;border-bottom-style:solid}.c5{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:60.8pt;border-top-color:#000000;border-bottom-style:solid}.c6{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:75pt;border-top-color:#000000;border-bottom-style:solid}.c3{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#ffffff;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:418.5pt;border-top-color:#000000;border-bottom-style:solid}.c24{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#ffffff;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:418.5pt;border-top-color:#000000;border-bottom-style:dashed}.c13{border-right-style:solid;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:bottom;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:100pt;border-top-color:#000000;border-bottom-style:solid;white-space:nowrap}.c1{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left;height:11pt}.c4{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c17{padding-top:0pt;padding-bottom:16pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c18{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:26pt;font-family:"Arial";font-style:normal}.c2{color:#666666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:15pt;font-family:"Arial";font-style:normal}.c10{padding-top:0pt;padding-bottom:3pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c21{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-family:"Arial";font-style:normal}.c7{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c0{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c14{border-spacing:0;border-collapse:collapse;margin-right:auto}.c23{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:center}.c16{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c20{font-size:13pt}.c19{height:21pt}.c26{height:23pt}.c11{height:11pt}.c22{font-size:10pt}.c15{height:20.1pt}.c12{height:29.1pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}
</style>
</head>
<body class="c16 doc-content">
<p class="c10 title" id="h.qexw0zqvhvnl">
<span class="c18" id="title-date">
Korean Words Practice for <span id="target-date">Loading...</span>
</span>
</p>
<p class="c17 subtitle" id="h.p3yinhw4luh1">
<span class="c2">
<br>
Korean Handwriting Practice</span>
</p>
<div id="practice-section">
<p class="c7">
Loading vocabulary...
</p>
</div>
<p class="c17 subtitle" id="h.ksdebyk61tdy" style="margin-top: 60pt;">
<span class="c2">
Randomized Drill (Alternating: English &harr; Korean)</span>
</p>
<div id="drill-section">
<p class="c7">
Loading drill...
</p>
</div>

<script>
// Parse CSV line
function parseCSVLine(line) {
    const result = [];
    let current = '';
    let inQuotes = false;
    
    for (let i = 0; i < line.length; i++) {
        const char = line[i];
        if (char === '"') {
            inQuotes = !inQuotes;
        } else if (char === ',' && !inQuotes) {
            result.push(current.trim());
            current = '';
        } else {
            current += char;
        }
    }
    result.push(current.trim());
    return result;
}

// Parse CSV content
function parseCSV(csvText) {
    const lines = csvText.trim().split('\n');
    const header = parseCSVLine(lines[0]);
    const data = [];
    
    for (let i = 1; i < lines.length; i++) {
        const values = parseCSVLine(lines[i]);
        const row = {};
        header.forEach((key, index) => {
            row[key] = values[index] || '';
        });
        data.push(row);
    }
    
    return data;
}

// Shuffle array
function shuffleArray(array) {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
}

// Generate practice section HTML
function generatePracticeSection(words) {
    let html = '';
    words.forEach((word, index) => {
        const korean = word.Word || word.word || 'missing korean';
        const english = word.English || word.english || 'missing english';
        const description = word.Description || word.description || 'missing description';
        
        html += `
<p class="c7" style="margin-bottom: 20pt;">
<table class="c14">
<tr class="c26">
<td class="c8" colspan="2" rowspan="1" style="border-right: none; border-left: none;">
<p class="c0">
<span class="c20">
${index + 1}. ${english} - ${korean}
</span>
</p>
</td>
</tr>
<tr class="c12">
<td class="c8" colspan="2" rowspan="1" style="border-right: none; border-left: none;">
<p class="c0">
<span class="c4">
Description: ${description}</span>
</p>
</td>
</tr>
<tr class="c15">
<td class="c13" colspan="1" rowspan="1">
<p class="c0" style="white-space: nowrap;">
<span class="c4">
Repeat 10 times:</span>
</p>
</td>
<td class="c24" colspan="1" rowspan="1">
<p class="c0 c11">
<span class="c4">
</span>
</p>
</td>
</tr>
</table>
</p>
`;
    });
    return html;
}

// Generate randomized drill section
function generateDrillSection(words) {
    if (words.length === 0) {
        return '<table class="c14"></table>';
    }
    
    const allDrillItems = [];
    
    // Repeat 5 times
    for (let round = 0; round < 5; round++) {
        // Shuffle words for this round (queue approach)
        const shuffledWords = shuffleArray([...words]);
        
        // Process all words, alternating direction every 10 words
        for (let i = 0; i < shuffledWords.length; i++) {
            const word = shuffledWords[i];
            const korean = word.Word || word.word || 'missing korean';
            const english = word.English || word.english || 'missing english';
            
            // Alternate every 10 words: first 10 are English→Korean, next 10 are Korean→English, etc.
            const groupIndex = Math.floor(i / 10);
            const isEnglishToKorean = groupIndex % 2 === 0;
            const globalIndex = allDrillItems.length;
            const foldMarker = globalIndex % 10 === 0 ? 'FOLD HERE' : '';
            
            allDrillItems.push({
                korean,
                english,
                isEnglishToKorean,
                foldMarker
            });
        }
    }
    
    let html = '<table class="c14">\n';
    allDrillItems.forEach((item, index) => {
        if (item.isEnglishToKorean) {
            // English → Korean: show English, write Korean
            html += `<tr class="c19">
<td class="c5" colspan="1" rowspan="1">
<p class="c0">
${item.english}
</p>
</td>
<td class="c9" colspan="1" rowspan="1">
<p class="c0 c11">
<span class="c4">
</span>
</p>
</td>
<td class="c25" colspan="1" rowspan="1">
<p class="c23">
<span class="c21 c22">
${item.foldMarker}
</span>
</p>
</td>
<td class="c6" colspan="1" rowspan="1">
<p class="c0">
${item.korean}
</p>
</td>
</tr>
`;
        } else {
            // Korean → English: show Korean, write English
            html += `<tr class="c19">
<td class="c5" colspan="1" rowspan="1">
<p class="c0">
${item.korean}
</p>
</td>
<td class="c9" colspan="1" rowspan="1">
<p class="c0 c11">
<span class="c4">
</span>
</p>
</td>
<td class="c25" colspan="1" rowspan="1">
<p class="c23">
<span class="c21 c22">
${item.foldMarker}
</span>
</p>
</td>
<td class="c6" colspan="1" rowspan="1">
<p class="c0">
${item.english}
</p>
</td>
</tr>
`;
        }
    });
    html += '</table>';
    return html;
}

// Set target date
function setTargetDate() {
    const date = new Date();
    const dateStr = date.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    });
    document.getElementById('target-date').textContent = dateStr;
}

// Load and process CSV
async function loadVocabulary() {
    try {
        // Try to load from server (works when served via http)
        const csvPath = '/output/korean_vocabulary.csv';
        const response = await fetch(csvPath);
        
        if (!response.ok) {
            throw new Error(`Failed to load CSV: ${response.statusText}`);
        }
        
        const csvText = await response.text();
        const words = parseCSV(csvText);
        
        // Set date
        setTargetDate();
        
        // Generate sections
        document.getElementById('practice-section').innerHTML = generatePracticeSection(words);
        document.getElementById('drill-section').innerHTML = generateDrillSection(words);
        
    } catch (error) {
        console.error('Error loading vocabulary:', error);
        document.getElementById('practice-section').innerHTML = '<p class="c7">Error loading vocabulary CSV. Make sure the file is in the output folder.</p>';
        document.getElementById('drill-section').innerHTML = '<p class="c7">Error loading vocabulary CSV.</p>';
    }
}

// Load vocabulary when page loads
window.addEventListener('DOMContentLoaded', () => {
    loadVocabulary().then(() => {
        // Auto-trigger print dialog after content is loaded
        // Small delay to ensure content is fully rendered
        setTimeout(() => {
            window.print();
        }, 500);
    });
});
</script>
</body>
</html>
